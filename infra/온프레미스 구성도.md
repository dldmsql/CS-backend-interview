# 온프레미스 구성

## 온프레미스 환경에서의 인프라 아키텍처 구성 시, 고려요소

1. 3 Tier 구성

    WEB, WAS, DB 구성이 기본이다. <br/>
    이렇게 구성하는 계층별로 독립성과 효율성을 보장하기 편한 구조를 갖기 위함이다. <br/> 
    WEB 서버는 정적 컨텐츠를 제공하는 역할을 주로 한다. 대표적으로 설치되는 엔진은 Nginx, Apache가 있다. <br/>
    WAS는 동적 컨텐츠를 제공한다. 비즈니스 로직이 담겨 있어 보안에 신경써야 한다. 대표적으로 설치되는 엔진은 Jeus, Tomcat이 있다. <br/>
    DB 서버는 데이터 처리를 담당한다. 현업에서는 RDS를 주로 사용하는데, 이때 사용되는 DBMS로는 MySQL과 Oracle이 대표적이다.

2. 이중화 및 HA 구성

    장애 대비 및 부하 분산을 위해 이중화와 HA 구성을 기본으로 한다.

- 웹 서버의 경우, L4 스위치를 통해 부하 분산
- WAS의 경우, 클러스터링을 통한 부하 분산
    <br/> Jeus 엔진 기준, EJB를 통해 세션 클러스터링을 한다. 
- DB의 경우, 클러스터링을 통한 데이터 처리 부하 분산
    <br/> Oracle 기준, RAC ( Real Application Cluster )를 통해 클러스터링을 한다.

3. 유닉스 서버 사용

    Unix 물리 서버를 도입하는 경우에는 논리적 파티션을 통해 3 티어 구성을 한다. 이는 자원의 효율성을 고려한 구성이다. 단, 논리적 구성에 있어 각 서버에 네트워크 구성도 고려해야 한다.

4. x86 서버 사용

    x86 물리 서버를 도입하는 경우에는 베어 메탈을 이용한 가상화 솔루션을 통해 vm 으로 3 티어 구성을 한다. 서버 가상화를 통해 서버들의 관리를 좀 더 편하게 하기 위함이다. 

- VM ware

VM ware를 이용하면 물리적 서버 여러 대를 하나의 가상 서버로 묶을 수 있다. 가상 서버에는 vSphere를 통해 resource pool을 구성할 수 있다. 여기에는 물리 서버의 NIC, HBA, Disk가 가상화되어 올라간다. vSwitch를 통해 vm 서버 간의 네트워크 구성을 할 수 있다. 

5. 망 분리

    웹 서버는 외부망에, WAS와 DB 서버는 내부망에 두는 것이 보안에 있어 바람직하다. 우리가 흔히 클라이언트라 칭하는, 인터넷을 통해 접근하는 사용자는 외부망을 통해 서비스를 이용한다. admin이라 불리는 내부 사용자의 경우, 내부망을 통해 서비스를 이용한다.

6. 방화벽과 IPS

    인터넷 - 방화벽 - IPS - 백본 - L4 - 서버 순으로 구성을 했었다. ( 과제 기준 )
    <br/> 방화벽 앞에 IPS를 둘 건지 뒤에 둘 건지는 요구사항에 따라 장비에 따라 달라진다. 우선순위를 어디에 두느냐와 장비가 갖는 성능에 따라 달라지기 때문이다.

7. 재해복구센터 DR

    아키텍처 구성 시, 주 센터와 재해 복구 센터라는 용어를 자주 듣게 된다. 주 센터는 실제로 운영 환경을 의미하고, 재해복구센터는 주 센터에 장애 발생 시를 대비하는 환경이다. 운영 비용의 효율을 고려해서 A-A 구조로 두 센터를 운영하기도 한다.

8. 스토리지

    외장 스토리지를 두어 서버들과 연결하여 데이터를 보관한다. 스토리지 내에는 볼륨이라는 공간이 있고, 운영 볼륨과 백업 볼륨이 기본으로 구성된다고 보면 된다. 운영 볼륨에는 운영 환경에서 발생하는 데이터를 담고 있고, 백업 볼륨에는 운영 볼륨의 데이터와 WAS의 OS를 백업한다.

    물리적 디스크를 논리적으로 구성할 수 있으며, 논리적 볼륨을 LUN( Logical Unit Number )이라 한다. LUN으로 구성하기 위해서 레이드 구성을 한다. RAID에는 0,1,01,10,3,4,5,6이 있다. <br/>
    * RAID 0 - Striping 이라 하여 물리적 디스크 2개에 데이터를 분산처리 하여 저장하는 기술이다. <br/>
    * RAID 1 - Mirroring 이라 하여 하나의 디스크에 저장되는 데이터를 다른 디스크에 그대로 복사하는 기술이다. usable 용량이 0에 비해 절반 뿐이지만, 장애 발생 시 다른 디스크를 사용할 수 있다는 점이 특징이다. <br/>
    * RAID 0 + 1 - 물리적 디스크 2개에 데이터를 분산 처리한 것에 대해 또다른 물리적 디스크 2개에 그대로 복사한 것이다.<br/>
    * RAID 1 + 0 - 하나의 디스크에 저장되는 데이터를 다른 디스크에 그대로 복사한 것을 하나의 묶음으로 간주하고 동일한 구성이 하나 더 존재한다. 묶음 1과 2는 전체 데이터의 분산 처리된 채로 저장된 것이다. <br/>
    * RAID 3,4 - 패리티 정보를 갖고 있는 디스크를 하나 더 두는 구성이다. <br/>
    🛢(1) 🛢(2) 🛢(3) <- 마지막 이 하나의 디스크가 패리티 정보를 갖는다. <br/>
    * RAID 5 - RAID 3,4와 동일하게 패리티 정보를 갖지만 하나의 디스크에 몰아서 저장하는 것이 아닌 3개의 디스크에 나누어 저장하여, 물리적 디스크에 장애가 발생하여도 그 피해가 덜하다. 안정성을 추구하는 구성에서 이 방식을 사용한다. <br/>
    * RAID 6 - 패리티 정보를 한 번 더 저장하는 구성이다. RAID 5 보다 쓰기 성능이 떨어진다.

    스토리지와 서버 간의 열결에는 SAN 방식을 많이 사용한다. ( 안전하기 때문이다. ) 이들의 연결에는 SAN 이라는 별도의 스위치가 존재한다. SAN 스위치에 연결되는 포트도 이중화하여 구성한다. 스위치에 가해지는 부하가 심해져 스토리지로 데이터가 이동하지 못하면 안되기 때문이다. 

9. 스위치

서버는 NIC와 스위치를 연결하여 네트워크를 사용할 수 있다.

- L2
<br/> Ethernet 레벨에서 동작한다. MAC 주소를 보고 적절한 포트로 패킷을 전송한다.
- L3
<br/> IP 레벨에서 동작한다. IP를 보고 라우팅한다.
- L4
<br/> TCP/UDP 레벨에서 동작한다. 포트를 보고 적절한 포트로 패킷을 전송한다. 로드밸런싱이 가능하다.
- L7
<br/> HTTP의 URL, FTP의 파일명을 통해 패킷 분석한다.

서버의 NIC 카드에는 2개의 포트가 있으며, 카드를 2장 두어 이중화 처리를 한다. 이를 가상화하여 Fail-Over를 지원한다. 이렇게 포트를 묶어서 가상화하는 기술을 Teaming 혹은 Bonding이라 한다.

10. 백업

    백업하는 데 걸리는 시간도 고려해야 한다. 스토리지와 스토리지 간의 데이터 전송은 DWDM이라는 별도의 네트워크 선을 통해 이루어진다. <br/>
    스토리지 간의 백업 방식에는 차등 증분 백업, 전체 백업, 누적 증분 백업이 있다. ( 나의 경우, 과제에서 차등 증분 백업을 선택했다. 그 이유는 특정 요일을 정하여 전체 백업을 한 뒤, 그 뒤로 변경사항에 대해서만 백업을 진행하여 백업 시간을 경감하고자 했기 때문이다. ) <br/>
    스토리지 내에 볼륨 간의 데이터 복제 방식에는 내부 복제 방식이 있다. <br/>
    
    백업의 3단계 구성<br/>
    1. 스토리지 내 볼륨 백업
    2. 디스크 백업
    3. 테이프 백업

    안정적인 백업을 위해 3단계에 걸쳐 백업을 한다. <br/> 스토리지 내 운영 볼륨으로부터 데이터를 백업 받는다. <br/> 그리고 디스크 백업 장비를 통해 디스크 형태로 백업을 한 번 더 한다. <br/> 백업 서버를 통해 테이프 백업 장비로 데이터를 옮겨 테이프 형태로 백업을 한다.

    